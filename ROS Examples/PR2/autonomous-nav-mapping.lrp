;;; New program created by TomasDiaz on 11 June 2016;; LRP Program that performs autonomous navigation and mapping;; by following a wall to its right.;; The robot moves forward and after certain distance moved it;; scans around (for map completion) and then resumes movement.;; The scanning is currently performed by just turning a fixed amount;; of time and then turning back the same amount.;; This is due to a problem in what is being published by a;; node, which is supposed to publish the turned angle, but doesn't;; work as expected.;; NOT BEING HANDLED:;;	- When there is no wall to its right (an open corner). At the moment;;  	   it just loops between turning left and right;;	- When it encounters an obstacle in front of it		; move -> base_controller/command; laser <- base_scan; movedDistance <- odom_moved_distance; radiansTurned <- odom_radians_turned(machine pr2	(var turn := [[:val | robot move: [:twist | twist angular z: val]]])	(var laserAt := [[:val | robot laser ranges at: val]])	(var distanceMoved := [0.0])	(var minDistance := [4.0])	(var initialAngle := [0.0])		(state moving		(running [robot move:					[:twist | twist linear x: 0.4]]))	(state movingTowardsWall		(running [robot move:					[:twist | twist linear y: -0.25]]))	(state stopped		(running [robot move:			[:twist | twist linear x: 0.0.					twist angular z: 0.0]]))		(state turningRight		(running [turn value: -0.1]))		(state turningLeft		(running [turn value: 0.1]))		(state scanningAround		(onentry [distanceMoved := robot movedDistance data.					initialAngle := robot radiansTurned data])		(running [turn value: 0.5]))			(state turningBackToMoving		(onentry [initialAngle := robot radiansTurned data])		(running [turn value: -0.5]))		(event tooFarFromWall [(laserAt value: 98) > 0.7])	(event closeEnoughToWall [(laserAt value: 98) <= 0.6])	(event frontCollision [((robot laser ranges copyFrom: 220 to: 420)					select: [:entry | entry < 0.6]) size >= 20])					(event headingTowardsSideWall [ (laserAt value: 1) - (laserAt value: 198) > 0.02 ])	(event headingAwayFromSideWall [(laserAt value: 198) - (laserAt value: 1) > 0.02])		(event properlyAlignedWithWall [((laserAt value: 1) - (laserAt value: 198)) abs  < 0.02])		(event movedEnough [(robot movedDistance data - distanceMoved) >= minDistance])		(event turnedHalfACircle [(robot radiansTurned data - initialAngle) abs >= 3.14])		(on tooFarFromWall moving -> movingTowardsWall)	(on closeEnoughToWall movingTowardsWall -> moving)		(on headingTowardsSideWall moving -> turningLeft)	(on properlyAlignedWithWall turningLeft -> moving)		(on headingAwayFromSideWall moving -> turningRight)	(on properlyAlignedWithWall turningRight -> moving)		(on movedEnough moving -> scanningAround)	(ontime 20000 scanningAround -> turningBackToMoving)	(ontime 20000 turningBackToMoving -> moving)	;(on turnedHalfACircle scanningAround -> turningBackToMoving)	;(on turnedHalfACircle turningBackToMoving -> moving)	)(spawn pr2 moving)